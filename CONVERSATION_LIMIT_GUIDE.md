# 🎯 对话轮数限制功能使用指南

## 📋 功能概述

新增的对话轮数限制功能允许您：
- 精确控制模拟的对话数量
- 实时监控对话进度
- 查看详细的对话历史记录
- 导出对话数据进行分析

## 🚀 使用方法

### 方法1：主菜单选择

运行程序后选择模式4：
```bash
python run.py

请选择运行模式:
1. 自动模拟 (运行20个tick)
2. 交互模式  
3. 快速演示 (5个tick)
4. 限制对话轮数模拟 (自定义)

请输入选择 (1-4): 4
```

然后按提示输入参数：
```
请输入最大对话轮数 (推荐20): 20
请输入最大tick数 (推荐50): 50  
请输入tick间隔秒数 (推荐2.0): 2.0
```

### 方法2：交互模式

进入交互模式后使用run命令：
```bash
MamaVillage> run 10 20
```
- 第一个参数：最大tick数 (10)
- 第二个参数：最大对话轮数 (20)

## 🎮 交互命令详解

### 基础命令
```bash
# 运行模拟（10个tick，最多20轮对话）
MamaVillage> run 10 20

# 查看当前状态（包含对话进度）
MamaVillage> status

# 查看最近20条对话记录
MamaVillage> conversations 20

# 导出对话记录到文件
MamaVillage> export_conversations 50

# 查看对话统计信息
MamaVillage> stats
```

### 高级命令
```bash
# 查看特定agent的详细信息
MamaVillage> agent 小李

# 清空所有数据（谨慎使用）
MamaVillage> clear

# 退出程序
MamaVillage> quit
```

## 📊 监控和分析

### 实时监控
运行过程中会显示：
```
⏰ Tick 3 - 14:23:45
🎯 活跃agent: ['小李', '张奶奶']
      💬 小李: 在群里聊天交流
         └─ 💬 对群聊说: "姐妹们，今天孩子特别乖😊"
📊 当前对话轮数: 8/20
```

### 对话记录查看
```
💬 对话历史记录 (最近20条)
================================================================================
 1. [2024-01-15 14:2] 💬 小李 → 群聊: "姐妹们，今天孩子特别乖😊"
 2. [2024-01-15 14:2] 🆘 小陈 → 群聊: "怎么办啊，宝宝不肯吃辅食😰"
 3. [2024-01-15 14:2] 💡 王芳 → 群聊: "我的经验是，先从果泥开始👍"
 ...
📊 共显示 20 条对话
```

### 统计信息
```
📊 对话统计信息
========================================
📈 总对话数: 20
🎯 本次模拟对话数: 20
⏱️ 模拟时长: 8 ticks

👥 各Agent对话统计:
  小李: 6 条 (30.0%)
  王芳: 5 条 (25.0%)
  张奶奶: 5 条 (25.0%)
  小陈: 4 条 (20.0%)

📝 对话类型统计:
  日常聊天: 15 条
  求助: 3 条
  建议: 2 条
```

## 💾 数据导出

导出的对话记录文件格式：
```
妈妈互助小区 - 对话记录
==================================================

1. [2024-01-15 14:2] 💬 小李 → 群聊: "姐妹们，今天孩子特别乖😊"
2. [2024-01-15 14:2] 🆘 小陈 → 群聊: "怎么办啊，宝宝不肯吃辅食😰"
...

导出时间: 2024-01-15 14:25:30
总对话数: 20
```

文件名格式：`conversations_20240115_142530.txt`

## 🎯 使用建议

### 推荐参数设置

| 用途 | 对话轮数 | Tick数 | 间隔 |
|------|----------|---------|------|
| 快速测试 | 5-10 | 10-20 | 1.0s |
| 标准演示 | 15-25 | 20-40 | 2.0s |
| 深度分析 | 30-50 | 50-100 | 3.0s |

### 最佳实践

1. **首次使用**：建议设置10轮对话，观察系统行为
2. **正式研究**：建议20-30轮对话，足够产生有意义的互动
3. **长期观察**：可设置50+轮对话，观察社群动态演化

### 注意事项

1. **API费用**：每轮对话都会调用OpenAI API，注意成本控制
2. **数据积累**：长时间运行会产生大量对话数据
3. **内存使用**：大量对话记录可能占用较多内存
4. **网络稳定**：确保网络连接稳定，避免API调用失败

## 🔧 故障排除

### 常见问题

**Q: 对话计数不准确？**
A: 检查是否所有对话类型都被正确计数，包括求助和分享

**Q: 模拟提前结束？**
A: 可能是达到了对话轮数限制，检查设置的max_conversations参数

**Q: 导出文件为空？**
A: 确认有对话记录生成，可以先用`conversations`命令查看

**Q: 对话质量不高？**
A: 调整tick间隔，给AI更多时间生成高质量对话

## 📈 数据分析建议

导出的对话数据可用于：
- 研究农村妈妈的交流模式
- 分析知识传播路径
- 评估不同角色的参与度
- 优化AI对话策略

建议结合统计信息进行综合分析，关注：
- 对话频率分布
- 话题演化趋势  
- 角色互动特点
- 求助响应效率

---

💡 **提示**：建议先从少量对话轮数开始，熟悉功能后再进行大规模模拟。